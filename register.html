 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول - مزاد الزمرد</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>تسجيل الدخول</h1>
<p>يرجى إدخال بياناتك للتسجيل في مزاد الزمرد</p>

<input type="text" id="fullName" placeholder="الاسم الثلاثي">
<input type="text" id="tribe" placeholder="القبيلة">
<input type="tel" id="phone" placeholder="رقم الجوال">

<br>
<button onclick="registerUser()">تسجيل</button>

<script type="module">
import { app } from './firebase.js';
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const db = getFirestore(app);

window.registerUser = async function() {
    let fullName = document.getElementById("fullName").value.trim();
    let tribe = document.getElementById("tribe").value.trim();
    let phone = document.getElementById("phone").value.trim();

    if (!fullName || !tribe || !phone) {
        alert("⚠ يرجى تعبئة جميع الحقول");
        return;
    }

    // التأكد إذا كان المستخدم مسجل من قبل
    const q = query(collection(db, "users"), where("phone", "==", phone));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
        await addDoc(collection(db, "users"), {
            fullName: fullName,
            tribe: tribe,
            phone: phone,
            createdAt: new Date().toISOString()
        });
    }

    // حفظ البيانات محلياً
    localStorage.setItem("userName", fullName);
    localStorage.setItem("tribe", tribe);
    localStorage.setItem("phone", phone);

    // التوجيه للصفحة الرئيسية
    window.location.href = "index.html";
};
</script>

</body>
</html>
